<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Budget Shark</title>
    <link rel="icon" type="image/png" href="icon.png">
    <link rel="apple-touch-icon" href="icon.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Pacifico&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --md-sys-color-background: #141218;
            --md-sys-color-surface: #1D1B20;
            --md-sys-color-primary: #D0BCFF;
            --md-sys-color-on-primary: #381E72;
            --md-sys-color-outline: #938F99;
            --md-sys-color-on-surface: #E6E1E5;
            --md-sys-color-on-surface-variant: #CAC4D0;
            --radius-xl: 28px;
            --radius-pill: 50px;
        }

        body { 
            background-color: var(--md-sys-color-background); 
            color: var(--md-sys-color-on-surface); 
            font-family: 'Roboto', sans-serif; 
            margin: 0; padding: 20px; 
            display: flex; flex-direction: column; align-items: center; 
            min-height: 100vh; overflow-x: hidden; 
        }

        .app-container { width: 100%; max-width: 420px; display: flex; flex-direction: column; gap: 20px; padding-bottom: 100px; }
        header { text-align: center; padding: 10px 0; }
        h1 { font-family: 'Pacifico', cursive; font-size: 34px; color: var(--md-sys-color-primary); margin: 0; }

        .segmented-control { background: var(--md-sys-color-surface); border: 1px solid var(--md-sys-color-outline); border-radius: var(--radius-pill); display: flex; position: relative; height: 52px; overflow: hidden; margin-bottom: 10px; }
        .segmented-control input { display: none; }
        .segmented-control label { flex: 1; z-index: 2; display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: 500; cursor: pointer; color: var(--md-sys-color-on-surface-variant); }
        .segmented-control input:checked + label { color: var(--md-sys-color-on-primary); transition: color 0.3s; }
        .selection-indicator { position: absolute; height: 100%; width: 33.33%; background-color: var(--md-sys-color-primary); border-radius: var(--radius-pill); top: 0; left: 0; transition: transform 0.4s cubic-bezier(0.2, 0, 0, 1); z-index: 1; }
        #tab-1:checked ~ .selection-indicator { transform: translateX(0%); }
        #tab-2:checked ~ .selection-indicator { transform: translateX(100%); }
        #tab-3:checked ~ .selection-indicator { transform: translateX(200%); }

        .hero-card { background: linear-gradient(135deg, #2b2930 0%, #1D1B20 100%); border-radius: var(--radius-xl); padding: 24px; border: 1px solid rgba(255,255,255,0.08); display: flex; flex-direction: column; gap: 12px; }
        .hero-label { font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 1.2px; color: var(--md-sys-color-on-surface-variant); display: block; }
        .hero-amount { font-size: 34px; font-weight: 700; color: var(--md-sys-color-primary); margin: 0; }
        
        .card { background-color: var(--md-sys-color-surface); border-radius: var(--radius-xl); padding: 20px; display: flex; flex-direction: column; gap: 12px; border: 1px solid rgba(255,255,255,0.03); }
        .card-header { display: flex; justify-content: space-between; align-items: flex-start; }
        
        .pill { padding: 6px 10px; border-radius: var(--radius-pill); font-size: 10px; font-weight: 700; text-transform: uppercase; border: 1.5px solid transparent; background: rgba(255,255,255,0.05); cursor: pointer; display: inline-block; }
        .status-pill { border-width: 2px; background: transparent; pointer-events: none; margin-left: 4px; }
        .over { border-color: #F2B8B5; color: #F2B8B5; }
        .under { border-color: #C2EFB3; color: #C2EFB3; }

        /* FIX: Ensure sliders are easy to grab */
        input[type=range] { -webkit-appearance: none; width: 100%; height: 40px; background: transparent; touch-action: pan-y; cursor: pointer; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 10px; border-radius: 50px; background: #35323a; }
        input[type=range]::-webkit-slider-thumb { height: 28px; width: 28px; border-radius: 50%; background: #ffffff; -webkit-appearance: none; margin-top: -9px; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }

        .liquid-container { position: relative; width: 100%; height: 50px; background: #2b2930; border-radius: 50px; overflow: hidden; margin: 10px 0; }
        .liquid-fill { position: absolute; left: 0; top: 0; height: 100%; background: linear-gradient(180deg, #4FC3F7 0%, #0288D1 100%); transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1); }
        .swimming-shark-img { width: 50px !important; position: absolute; right: 0; top: 5px; cursor: pointer; z-index: 10; transition: transform 0.2s; }
        
        #chomp-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 2000; display: none; align-items: center; justify-content: center; background: rgba(0,0,0,0.9); pointer-events: none; }
        .chomp-shark-sprite { width: 200px !important; position: absolute; left: -250px; transition: none; }

        .tiny-input { background: rgba(255,255,255,0.08); border: 1px solid var(--md-sys-color-outline); color: white; border-radius: 12px; padding: 8px; width: 90px; text-align: center; font-size: 14px; }
        .deposit-btn { background-color: var(--md-sys-color-primary); color: var(--md-sys-color-on-primary); border: none; padding: 10px 15px; border-radius: var(--radius-pill); font-weight: bold; font-size: 12px; cursor: pointer; margin-top: 5px; }
        .reset-btn { background: #F2B8B5; color: #601410; border: none; padding: 15px; border-radius: var(--radius-xl); font-weight: 800; cursor: pointer; width: 100%; margin-top: 10px; }

        #celebration-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 12, 20, 0.98); z-index: 1000; display: none; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 20px; }
    </style>
</head>
<body>

<div id="chomp-overlay"><img src="animated-shark.png" class="chomp-shark-sprite" id="chomp-shark-anim"></div>

<div id="celebration-overlay">
    <h1 style="font-family: 'Pacifico', cursive; color: #FF99CC; font-size: 42px;">GOAL REACHED!</h1>
    <p style="color: #D0BCFF; font-weight: 700; font-size: 20px;">I KNEW YOU COULD DO IT, MEG!! ❤️</p>
    <button class="deposit-btn" style="padding: 15px 30px; font-size: 16px;" onclick="document.getElementById('celebration-overlay').style.display='none'">You're my hero!</button>
</div>

<div class="app-container">
    <header><h1>Budget Shark</h1></header>

    <div class="segmented-control">
        <input type="radio" name="v" id="tab-1" checked onchange="switchTab('p1')"><label for="tab-1">Paycheck 1</label>
        <input type="radio" name="v" id="tab-2" onchange="switchTab('p2')"><label for="tab-2">Paycheck 2</label>
        <input type="radio" name="v" id="tab-3" onchange="switchTab('monthly')"><label for="tab-3">Total Month</label>
        <div class="selection-indicator"></div>
    </div>

    <div class="hero-card">
        <div style="display: flex; justify-content: space-between; align-items: flex-end;">
            <div><span class="hero-label">Target Savings</span><p class="hero-amount" id="target-savings-display">$0</p></div>
            <div style="text-align: right; display: flex; flex-direction: column; align-items: flex-end;">
                <span class="hero-label">Actual Saved</span>
                <input type="number" id="actual-savings-input" class="tiny-input">
                <button class="deposit-btn" id="deposit-action" onclick="commitDeposit()">Deposit</button>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <span class="hero-label">Income This Period</span>
            <input type="number" id="income-input" class="tiny-input" oninput="updateIncome(this.value)">
        </div>
    </div>
    
    <div id="category-container" style="display: flex; flex-direction: column; gap: 15px;"></div>

    <div class="hero-card">
        <div style="display: flex; justify-content: space-between; align-items: flex-end;">
            <span class="hero-label" style="color:var(--md-sys-color-primary)">Goal Progress</span>
            <div style="text-align: right;">
                <span class="hero-label">Banked Total</span>
                <input type="number" id="base-savings-input" class="tiny-input" style="width: 80px;" oninput="updateBase(this.value)">
            </div>
        </div>
        <div class="liquid-container">
            <div id="goal-progress-fill" class="liquid-fill">
                <img src="animated-shark.png" class="swimming-shark-img" id="progress-shark" onclick="sharkClick()">
            </div>
        </div>
        <div style="display: flex; justify-content: space-between; font-size: 12px; font-weight: 700;">
            <span id="total-saved-label">$0 saved</span>
            <span>Goal: $5,000</span>
        </div>
        <button id="reset-month-btn" class="reset-btn" style="display:none;" onclick="endMonthReset()">Close Month & Bank Savings</button>
    </div>
</div>

<script>
    const getExpenses = () => ({
        'tithe': { label: 'Tithe', val: 200, goal: 200, max: 400 },
        'rent': { label: 'Rent', val: 400, goal: 400, max: 800 },
        'phone': { label: 'Phone', val: 27.5, goal: 27.5, max: 80 },
        'insur': { label: 'Insurance', val: 280, goal: 280, max: 600 },
        'gas': { label: 'Gas', val: 50, goal: 50, max: 200 },
        'spend': { label: 'Spending', val: 100, goal: 100, max: 400 }
    });

    let state = JSON.parse(localStorage.getItem('SharkBudget_V7')) || {
        currentTab: 'p1',
        baseSavings: 0,
        hasCelebrated: false,
        p1: { income: 2244, actualSavings: 0, expenses: getExpenses() },
        p2: { income: 2244, actualSavings: 0, expenses: getExpenses() }
    };

    function switchTab(t) { state.currentTab = t; render(); }
    
    function updateExp(key, val) {
        if (state.currentTab === 'monthly') return;
        state[state.currentTab].expenses[key].val = parseFloat(val);
        save();
        render(); 
    }

    function setTarget(key) {
        if (state.currentTab === 'monthly') return;
        state[state.currentTab].expenses[key].val = state[state.currentTab].expenses[key].goal;
        save();
        render();
    }

    function updateIncome(v) { if (state.currentTab !== 'monthly') { state[state.currentTab].income = parseFloat(v) || 0; save(); calculateMonthly(); } }
    function updateBase(v) { state.baseSavings = parseFloat(v) || 0; save(); calculateMonthly(); }

    function commitDeposit() {
        if (state.currentTab === 'monthly') return;
        const val = parseFloat(document.getElementById('actual-savings-input').value) || 0;
        state[state.currentTab].actualSavings = val;
        save();
        calculateMonthly();
        // Visual feedback
        confetti({ particleCount: 40, spread: 70, origin: { y: 0.8 } });
    }

    function endMonthReset() {
        if(!confirm("Close out the month? This will move your paycheck savings into the 'Banked Total' and reset your sliders!")) return;
        state.baseSavings += (state.p1.actualSavings + state.p2.actualSavings);
        state.p1.actualSavings = 0; state.p2.actualSavings = 0;
        state.p1.expenses = getExpenses(); state.p2.expenses = getExpenses();
        save();
        render();
    }

    function save() { localStorage.setItem('SharkBudget_V7', JSON.stringify(state)); }

    function render() {
        const container = document.getElementById('category-container');
        container.innerHTML = '';
        const isMonthly = state.currentTab === 'monthly';
        
        // Update Static UI
        document.getElementById('income-input').value = isMonthly ? (state.p1.income + state.p2.income) : state[state.currentTab].income;
        document.getElementById('income-input').disabled = isMonthly;
        document.getElementById('base-savings-input').value = state.baseSavings;
        document.getElementById('reset-month-btn').style.display = isMonthly ? 'block' : 'none';
        document.getElementById('deposit-action').style.display = isMonthly ? 'none' : 'block';

        // Update Actual Savings Input (Protect focus)
        if (document.activeElement !== document.getElementById('actual-savings-input')) {
            document.getElementById('actual-savings-input').value = isMonthly ? (state.p1.actualSavings + state.p2.actualSavings) : state[state.currentTab].actualSavings;
        }
        document.getElementById('actual-savings-input').disabled = isMonthly;

        Object.keys(getExpenses()).forEach(k => {
            let val = isMonthly ? (state.p1.expenses[k].val + state.p2.expenses[k].val) : state[state.currentTab].expenses[k].val;
            let goal = isMonthly ? (state.p1.expenses[k].goal + state.p2.expenses[k].goal) : state[state.currentTab].expenses[k].goal;
            let max = isMonthly ? (state.p1.expenses[k].max + state.p2.expenses[k].max) : state[state.currentTab].expenses[k].max;
            
            const diff = val - goal;
            const statusText = diff === 0 ? '' : (diff > 0 ? `+$${diff.toFixed(0)}` : `-$${Math.abs(diff).toFixed(0)}`);

            container.innerHTML += `
                <div class="card">
                    <div class="card-header">
                        <div>
                            <span class="hero-label">${state.p1.expenses[k].label}</span>
                            <div class="pill" onclick="setTarget('${k}')">Target: $${goal.toFixed(0)}</div>
                            ${statusText ? `<div class="pill status-pill ${diff > 0 ? 'over' : 'under'}">${statusText}</div>` : ''}
                        </div>
                        <span style="font-weight:700; font-size:24px;">$${Math.round(val)}</span>
                    </div>
                    ${!isMonthly ? `<input type="range" min="0" max="${max}" step="1" value="${val}" oninput="updateExp('${k}', this.value)">` : ''}
                </div>
            `;
        });
        calculateMonthly();
    }

    function calculateMonthly() {
        const p1Exp = Object.values(state.p1.expenses).reduce((a, b) => a + b.val, 0);
        const p2Exp = Object.values(state.p2.expenses).reduce((a, b) => a + b.val, 0);
        const target = (state.p1.income + state.p2.income) - (p1Exp + p2Exp);
        document.getElementById('target-savings-display').innerText = "$" + Math.round(target).toLocaleString();
        
        const totalBanked = state.baseSavings + state.p1.actualSavings + state.p2.actualSavings;
        document.getElementById('total-saved-label').innerText = "$" + Math.round(totalBanked).toLocaleString() + " saved";
        
        const progress = Math.min((totalBanked / 5000) * 100, 100);
        document.getElementById('goal-progress-fill').style.width = progress + "%";

        // CELEBRATION TRIGGER
        if (totalBanked >= 5000 && !state.hasCelebrated) {
            state.hasCelebrated = true; save();
            document.getElementById('celebration-overlay').style.display = 'flex';
            confetti({ particleCount: 150, spread: 100, origin: { y: 0.6 } });
        }
    }

    let clicks = 0;
    function sharkClick() {
        clicks++;
        if(clicks < 4) {
            confetti({ particleCount: 20, spread: 60, origin: { y: 0.8 }, shapes: [confetti.shapeFromText({ text: '❤️' })] });
        } else {
            const overlay = document.getElementById('chomp-overlay');
            const shark = document.getElementById('chomp-shark-anim');
            overlay.style.display = 'flex';
            shark.style.left = '-250px';
            shark.style.transition = 'none';
            
            setTimeout(() => {
                shark.style.transition = 'left 1.5s linear';
                shark.style.left = '110%';
                setTimeout(() => { 
                    overlay.style.display = 'none'; 
                    clicks = 0; 
                    shark.style.left = '-250px';
                    shark.style.transition = 'none';
                }, 1600);
            }, 50);
        }
    }
    render();
</script>
</body>
</html>
